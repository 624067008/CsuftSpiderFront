(function(N){var m=function(l){this.el=document.querySelector(l.el),this.Timetables=l.timetables||[],this.week=l.week||[],this.merge=typeof l.merge=="boolean"?l.merge:!0,this.TimetableType=l.timetableType||[],this.leftHandText=[],this.highlightWeek=l.highlightWeek||"",this.gridOnClick=typeof l.gridOnClick=="function"?l.gridOnClick:void 0;var r=l.styles||{};this.leftHandWidth=r.leftHandWidth||40,this.Gheight=r.Gheight||48,this.defaultPalette=["#f05261","#48a8e4","#ffd061","#52db9a","#70d3e6","#52db9a","#3f51b5","#f3d147","#4adbc3","#673ab7","#f3db49","#76bfcd","#b495e1","#ff9800","#8bc34a"],this.palette=typeof r.palette=="boolean"&&!r.palett?!1:(r.palette||[]).concat(this.defaultPalette),this._init()};m.prototype={_init:function(l){var l=l||{},r=l.styles||{},k=l.gridOnClick||this.gridOnClick,v=typeof l.merge=="boolean"?l.merge:this.merge,S=l.highlightWeek||this.highlightWeek,W=this.leftHandText,w=r.leftHandWidth||this.leftHandWidth,C=r.Gheight||this.Gheight,c;typeof r.palette=="boolean"&&!r.palette?c=!1:c=r.palette?(r.palette||[]).concat(this.defaultPalette):this.palette;var b=l.timetables||this.Timetables,g=l.week||this.week,p=JSON.parse(JSON.stringify(l.timetableType||this.TimetableType)),O=l.timetableType||this.TimetableType,H=p.length;b.forEach(function(a,t){if(a.length<H)for(var e=0;e<H-a.length;e++)a.push("")}),l.setNewOption&&this.el.removeChild(this.el.childNodes[0]);var f=document.createElement("div");f.id="courseWrapper",f.style.position="relative",f.style.paddingLeft=w+"px",f.style.border="1px solid #dbdbdb",p.forEach(function(a,t){a.unshift(t+1)});var o=document.createElement("div");o.className="Courses-leftHand",o.style.position="absolute",o.style.left=0,o.style.top=0,o.style.width=w+"px";var x=b[0].map(function(a,t){return[]});x.forEach(function(a,t){b.forEach(function(e,i){x[t].push(e[t])})});var n=[];v&&b.forEach(function(a,t){n[t]||(n[t]=[]),a.forEach(function(e,i){if(!i)return n[t].push({name:e,length:1});if(e===(n[t][i-1]||{}).name&&e){var s=(n[t][i-1]||{}).sameIndex;return s||s===0?(n[t][s].length++,n[t].push({name:e,length:0,sameIndex:s})):(n[t][i-1].length++,n[t].push({name:e,length:0,sameIndex:i-1}))}else return n[t].push({name:e,length:1})})});var T=document.createElement("div");T.style.overflow="hidden",T.className="Courses-head",g.forEach(function(a,t){var e=document.createElement("div"),i=S===t+1?"highlight-week ":"";e.className=i+"Courses-head-"+(t+1),e.innerText=a,e.style.cssFloat="left",e.style.boxSizing="border-box",e.style.whiteSpace="nowrap",e.style.width=100/g.length+"%",T.appendChild(e)}),f.appendChild(T);var E=document.createElement("div");E.className="Courses-content";var u=0;x.forEach(function(a,t){var e=document.createElement("ul");e.style.listStyle="none",e.style.padding="0px",e.style.margin="0px",e.style.minHeight=C+"px",e.className="stage_"+((p[0]||[])[0]||"none"),--(p[0]||[])[2],(p[0]||[])[2]||p.shift(),a.forEach(function(i,s){if(!(s>g.length-1)){var h=document.createElement("li");if(h.style.cssFloat="left",h.style.width=100/g.length+"%",h.style.height=C+"px",h.style.boxSizing="border-box",h.style.position="relative",v&&n[s][t].length>1){var d=document.createElement("span");d.style.position="absolute",d.style.zIndex=9,d.style.width="100%",d.style.height=C*n[s][t].length+"px",d.style.left=0,d.style.top=0,c&&(d.style.backgroundColor=c[u],d.style.color="#fff",u++,u>c.length&&(u=0)),d.innerText=n[s][t].name,d.className="course-hasContent",h.appendChild(d)}else v&&n[s][t].length===0?h.innerText="":(i&&c?(h.style.backgroundColor=c[u],h.style.color="#fff",u++,u>c.length&&(u=0)):i&&(h.className="course-hasContent"),h.innerText=i||"");h.onclick=function(L){var P=document.querySelectorAll(".Courses-content ul li").forEach(function(G,F){G.classList.remove("grid-active")});this.className="grid-active";var z={name:i,week:g[s],index:t+1,length:v?n[s][t].length:1};k&&k(z)},e.appendChild(h)}}),E.appendChild(e)}),f.appendChild(E),f.appendChild(o),this.el.appendChild(f);var _=(document.querySelector(".stage_1 li")||document.querySelector(".stage_none li")).offsetHeight,q=document.querySelector(".Courses-head").offsetHeight,y=document.createElement("div");y.className="left-hand-TextDom",y.style.height=q+"px",y.style.boxSizing="border-box",W.forEach(function(a){var t=document.createElement("div");t.innerText=a,y.appendChild(t)}),o.appendChild(y),O.forEach(function(a,t){var e=document.createElement("div");if(e.style.width="100%",e.style.height=_*a[1]+"px",e.style.boxSizing="border-box",typeof a[0]=="object")for(var i in a[0]){var s=document.createElement("p");s.innerText=a[0][i],s.style.margin="0px",s.className="left-hand-"+i,e.appendChild(s)}else e.innerText=a[0]||"";e.className="left-hand-"+(t+1),o.appendChild(e)})},setOption:function(l){(l||{}).setNewOption=!0,this._init(l)}},typeof module!="undefined"&&module.exports&&(module.exports=m),typeof define=="function"&&define(function(){return m}),N.Timetables=m})(this);
